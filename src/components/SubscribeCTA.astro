---
interface Props {
  title?: string;
  description?: string;
  emailPlaceholder?: string;
  subscribeText?: string;
  subscribedText?: string;
  errorMessage?: string;
  successMessage?: string;
}

const {
  title = "Stay Updated",
  description = "Get notified when we add new vendors, features, or automation insights.",
  emailPlaceholder = "Enter your email address",
  subscribeText = "Subscribe",
  subscribedText = "Subscribed!",
  errorMessage = "Please enter a valid email address.",
  successMessage = "Thanks for subscribing!",
} = Astro.props;

const formId = `subscribe-form-${Math.random().toString(36).substr(2, 9)}`;
const emailInputId = `email-input-${Math.random().toString(36).substr(2, 9)}`;
const submitBtnId = `submit-btn-${Math.random().toString(36).substr(2, 9)}`;
const messageDivId = `form-message-${Math.random().toString(36).substr(2, 9)}`;
---
<section id="subscribe" class="py-16 md:py-24 bg-brand-50">
  <div class="container-px mx-auto max-w-4xl">
    <div class="card bg-white text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
        {title}
      </h2>
      <p class="text-lg text-gray-600 mb-8">
        {description}
      </p>
      <form id={formId} class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
        <input
          type="email"
          id={emailInputId}
          name="email"
          placeholder={emailPlaceholder}
          required
          class="flex-1 px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent"
        />
        <button type="submit" id={submitBtnId} class="btn-primary px-6 py-3 whitespace-nowrap">
          {subscribeText}
        </button>
      </form>
      <div id={messageDivId} class="mt-4 text-sm hidden"></div>
    </div>
  </div>
</section>

<script define:vars={{ formId, emailInputId, submitBtnId, messageDivId, errorMessage, successMessage, subscribedText, subscribeText }}>
  const form = document.getElementById(formId);
  const emailInput = document.getElementById(emailInputId);
  const submitBtn = document.getElementById(submitBtnId);
  const messageDiv = document.getElementById(messageDivId);

  if (form) {
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const email = emailInput?.value.trim();
      
      if (!email) {
        showMessage(errorMessage, 'error');
        return;
      }

      // Client-side only - just show success state
      submitBtn.disabled = true;
      submitBtn.textContent = subscribedText;
      showMessage(successMessage, 'success');
      
      // Reset after 3 seconds
      setTimeout(() => {
        form.reset();
        submitBtn.disabled = false;
        submitBtn.textContent = subscribeText;
        messageDiv.classList.add('hidden');
      }, 3000);
    });
  }

  function showMessage(text, type) {
    if (!messageDiv) return;
    messageDiv.textContent = text;
    messageDiv.classList.remove('hidden');
    messageDiv.className = `mt-4 text-sm ${type === 'success' ? 'text-green-600' : 'text-red-600'}`;
  }
</script>

