---
interface LogoBoxProps {
  src?: string | null;
  alt?: string | null;
  variant?: "light" | "dark" | "neutral" | "brand";
  size?: "sm" | "md" | "lg";
  logoWidth?: number | null;
  logoHeight?: number | null;
}

const { 
  src, 
  alt,
  variant = "light",
  size = "md",
  logoWidth,
  logoHeight
} = Astro.props;

/**
 * LogoBox - The authority component for vendor logo display.
 * 
 * Responsibilities:
 * - Container sizing
 * - Background variant
 * - Image scaling rules
 * - Fallback UI
 * - Accessibility
 */

// Background variant mapping
const variantMap: Record<string, string> = {
  light: "bg-white border border-gray-200",
  dark: "bg-gray-900 border border-gray-700",
  neutral: "bg-gray-100 border border-gray-200",
  brand: "bg-brand-50 border border-gray-200",
};

// Size mapping - fixed sizes for consistent layout
const sizeMap: Record<string, { container: string; maxWidth: number; maxHeight: number }> = {
  sm: { container: "w-[140px] h-[56px]", maxWidth: 124, maxHeight: 40 }, // 140-16=124, 56-16=40
  md: { container: "w-[200px] h-[80px]", maxWidth: 184, maxHeight: 64 }, // 200-16=184, 80-16=64
  lg: { container: "w-[280px] h-[112px]", maxWidth: 264, maxHeight: 96 }, // 280-16=264, 112-16=96
};

const bgClass = variantMap[variant] || variantMap.light;
const sizeConfig = sizeMap[size] || sizeMap.md;
const containerSize = sizeConfig.container;
const maxLogoWidth = sizeConfig.maxWidth;
const maxLogoHeight = sizeConfig.maxHeight;
---

{(() => {
  const logoUrl = src && typeof src === 'string' ? src.trim() : null;
  const hasLogo = logoUrl && logoUrl.length > 0;
  const imageId = `logo-img-${Math.random().toString(36).substr(2, 9)}`;
  
  return hasLogo ? (
    <>
      <div class={`${containerSize} flex items-center justify-center rounded-lg ${bgClass} p-2`} style="overflow: hidden;">
        <img
          id={imageId}
          src={logoUrl}
          alt={alt || "Logo"}
          style={`pointer-events: none; display: block; width: auto; height: auto; max-width: ${maxLogoWidth}px; max-height: ${maxLogoHeight}px; object-fit: contain;`}
          loading="lazy"
          decoding="async"
        />
      </div>
      <script define:vars={{ imageId, logoUrl }}>
        (function() {
          const img = document.getElementById(imageId);
          if (img) {
            img.addEventListener('error', function() {
              console.error('Logo image failed to load:', logoUrl);
              img.style.display = 'none';
            });
            img.addEventListener('load', function() {
              if (img.naturalWidth === 0 || img.naturalHeight === 0) {
                console.warn('Logo image loaded but has zero dimensions:', logoUrl);
              }
            });
          }
        })();
      </script>
    </>
  ) : (
    <div class={`${containerSize} flex items-center justify-center rounded-lg bg-gray-100 border border-gray-200`}>
      <span class="text-xs text-gray-400">No Logo</span>
    </div>
  );
})()}

