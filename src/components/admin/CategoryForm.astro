---
import { CATEGORY_ICONS } from '../../lib/categoryIcons';
import { getIconUrl } from '../../lib/iconUtils';

interface Props {
  category: any | null;
}

const { category } = Astro.props;
const isNewCategory = !category || !category.id;

// Determine form action URL
const formAction = isNewCategory 
  ? '/api/admin/create-category' 
  : '/api/admin/update-category';
---

<form method="POST" action={formAction} class="space-y-8">
  {!isNewCategory && category?.id && (
    <input type="hidden" name="id" value={category.id} />
  )}

  <!-- BASIC INFORMATION -->
  <section>
    <h2 class="text-xl font-semibold text-gray-900 mb-4 border-b pb-1">
      Basic Information
    </h2>
    
    <div>
      <label for="slug" class="block text-sm font-medium text-gray-700 mb-1">
        Slug *
      </label>
      <input
        type="text"
        id="slug"
        name="slug"
        value={category?.slug || ''}
        required
        class="border border-gray-300 rounded-md px-3 py-2 w-full text-sm mb-4 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
      />
      <p class="text-xs text-gray-500 mt-1">URL-friendly identifier</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="name_en" class="block text-sm font-medium text-gray-700 mb-1">
          Name (English) *
        </label>
        <input
          type="text"
          id="name_en"
          name="name_en"
          value={category?.name_en || ''}
          required
          class="border border-gray-300 rounded-md px-3 py-2 w-full text-sm mb-4 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
        />
      </div>
      
      <div>
        <label for="name_de" class="block text-sm font-medium text-gray-700 mb-1">
          Name (German)
        </label>
        <input
          type="text"
          id="name_de"
          name="name_de"
          value={category?.name_de || ''}
          class="border border-gray-300 rounded-md px-3 py-2 w-full text-sm mb-4 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
        />
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="description_en" class="block text-sm font-medium text-gray-700 mb-1">
          Description (English)
        </label>
        <textarea
          id="description_en"
          name="description_en"
          rows="4"
          class="border border-gray-300 rounded-md px-3 py-2 w-full text-sm mb-4 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
        >{category?.description_en || ''}</textarea>
      </div>
      
      <div>
        <label for="description_de" class="block text-sm font-medium text-gray-700 mb-1">
          Description (German)
        </label>
        <textarea
          id="description_de"
          name="description_de"
          rows="4"
          class="border border-gray-300 rounded-md px-3 py-2 w-full text-sm mb-4 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
        >{category?.description_de || ''}</textarea>
      </div>
    </div>
  </section>

  <!-- ICON SELECTION -->
  <section>
    <h2 class="text-xl font-semibold text-gray-900 mb-4 border-b pb-1">
      Icon Selection
    </h2>
    
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        Choose an icon
      </label>
      <div class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3 border border-gray-300 rounded-md p-4 mb-4">
        {CATEGORY_ICONS.map((iconName) => {
          const isSelected = category?.icon_name === iconName;
          const iconUrl = getIconUrl(iconName);
          return (
            <label class={`p-3 border rounded-md cursor-pointer ${isSelected ? "border-black" : "border-gray-300"}`}>
              <input type="radio" name="icon_name" value={iconName} checked={isSelected} class="sr-only" />
              {iconUrl && <img src={iconUrl} alt={iconName.replace(/-/g, " ")} class="w-6 h-6 mx-auto" />}
              <span class="text-xs text-gray-600 block text-center mt-1">{iconName.replace(/-/g, " ")}</span>
            </label>
          );
        })}
      </div>
      <p class="text-xs text-gray-500">Select an icon to represent this category</p>
    </div>
  </section>

  <!-- SETTINGS -->
  <section>
    <h2 class="text-xl font-semibold text-gray-900 mb-4 border-b pb-1">
      Settings
    </h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="order_index" class="block text-sm font-medium text-gray-700 mb-1">
          Order Index
        </label>
        <input
          type="number"
          id="order_index"
          name="order_index"
          value={category?.order_index ?? ''}
          min="0"
          step="1"
          class="border border-gray-300 rounded-md px-3 py-2 w-full text-sm mb-4 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent"
        />
        <p class="text-xs text-gray-500 mt-1">Lower numbers appear first (0, 1, 2, ...)</p>
      </div>
      
      <div class="flex items-center pt-6">
        <label class="flex items-center gap-2 cursor-pointer">
          <input
            type="checkbox"
            id="is_active"
            name="is_active"
            checked={category?.is_active !== false}
            class="w-4 h-4 text-black border-gray-300 rounded focus:ring-black"
          />
          <span class="text-sm font-medium text-gray-700">Active</span>
        </label>
        <p class="text-xs text-gray-500 ml-4">Inactive categories are hidden from public pages</p>
      </div>
    </div>
  </section>

  <!-- SUBMIT BUTTONS -->
  <div class="flex items-center justify-between pt-4 border-t">
    <a
      href="/admin/categories"
      class="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm font-medium"
    >
      Cancel
    </a>
    <button
      type="submit"
      class="px-6 py-3 bg-black text-white rounded-md hover:bg-gray-900 transition-colors font-medium"
    >
      {isNewCategory ? 'Create Category' : 'Save Changes'}
    </button>
  </div>
</form>

