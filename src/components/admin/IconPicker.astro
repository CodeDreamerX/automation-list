---
import { getIconUrl } from '../../lib/iconUtils';

interface Props {
  icons: string[];
  selectedIcon?: string;
}

const { icons, selectedIcon = '' } = Astro.props;
---

<div 
  class="icon-picker-container grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3 border border-gray-300 rounded-md p-4"
>
  <input 
    type="hidden" 
    name="icon_name" 
    class="icon-picker-input"
    value={selectedIcon}
  />
  
  {icons.map((iconName) => {
    const iconUrl = getIconUrl(iconName);
    const displayName = iconName.replace(/-/g, ' ');
    const isSelected = selectedIcon === iconName;
    
    return (
      <button
        type="button"
        data-icon-name={iconName}
        class={`icon-picker-button p-3 border rounded-md cursor-pointer transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 ${
          isSelected ? 'border-black bg-gray-50' : 'border-gray-300 hover:border-gray-400'
        }`}
      >
        {iconUrl && (
          <img 
            src={iconUrl} 
            alt={displayName}
            class="w-6 h-6 mx-auto" 
          />
        )}
        <span class="text-xs text-gray-600 block text-center mt-1">
          {displayName}
        </span>
      </button>
    );
  })}
</div>

<script is:inline>
  (function() {
    // Find all icon picker containers on the page
    const containers = document.querySelectorAll('.icon-picker-container');
    
    containers.forEach(function(container) {
      const hiddenInput = container.querySelector('.icon-picker-input');
      if (!hiddenInput) return;
      
      const buttons = container.querySelectorAll('.icon-picker-button');
      
      function selectIcon(iconName) {
        // Update hidden input
        hiddenInput.value = iconName;
        
        // Update button styles
        buttons.forEach(function(button) {
          const btnIconName = button.getAttribute('data-icon-name');
          if (btnIconName === iconName) {
            button.classList.remove('border-gray-300', 'hover:border-gray-400');
            button.classList.add('border-black', 'bg-gray-50');
          } else {
            button.classList.remove('border-black', 'bg-gray-50');
            button.classList.add('border-gray-300', 'hover:border-gray-400');
          }
        });
      }
      
      // Add click handlers
      buttons.forEach(function(button) {
        button.addEventListener('click', function() {
          const iconName = button.getAttribute('data-icon-name');
          if (iconName) {
            selectIcon(iconName);
          }
        });
      });
    });
  })();
</script>

