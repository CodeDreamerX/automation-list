---
export const prerender = false;

// Language detection from Accept-Language header
const acceptLanguage = Astro.request.headers.get("accept-language") || "";

// Parse Accept-Language header to find preferred language
function detectLanguageFromHeader(header: string): string {
  if (!header) return "en";
  
  // Parse Accept-Language header (e.g., "en-US,en;q=0.9,de;q=0.8")
  const languages = header
    .split(",")
    .map(lang => {
      const [code, q = "1"] = lang.trim().split(";q=");
      return { code: code.split("-")[0].toLowerCase(), quality: parseFloat(q) };
    })
    .sort((a, b) => b.quality - a.quality);

  // Check if German is preferred (check first language or any with quality > 0.5)
  const prefersGerman = languages.length > 0 && languages[0].code === "de";
  
  return prefersGerman ? "de" : "en";
}

// Determine language (default to "en")
const lang = detectLanguageFromHeader(acceptLanguage);

// Redirect to language-specific homepage
// Using 307 (Temporary Redirect) instead of 301 (Permanent Redirect)
// because language detection can change and we're in MVP phase
const redirectUrl = `/${lang}/`;

// Preserve query string if present
const queryString = Astro.url.search;
const finalRedirectUrl = queryString ? `${redirectUrl}${queryString}` : redirectUrl;

return Astro.redirect(finalRedirectUrl, 307);
