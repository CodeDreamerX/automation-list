---
export const prerender = false;

import { supabase } from '../../lib/supabaseClient';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  // Fetch all vendor slugs from Supabase
  const { data: vendors, error } = await supabase
    .from('vendors')
    .select('slug');

  if (error) {
    console.error('Error fetching vendor slugs:', error);
    return [];
  }

  // Generate paths for each slug
  return (vendors || []).map((vendor) => ({
    params: { slug: vendor.slug },
  }));
}

// Fetch full vendor data by slug
const { slug } = Astro.params;

const { data: vendor, error } = await supabase
  .from('vendors')
  .select('name, country, region, website, email, phone, category, technologies, languages, certifications, tags, description')
  .eq('slug', slug)
  .maybeSingle();

if (error) {
  console.error('Error fetching vendor:', error);
}

if (!vendor) {
  return Astro.redirect('/en/vendors');
}

const engNavItems = [
  { label: "Home", href: "/en/" },
  { label: "Features", href: "/en/features" },
  { label: "Categories", href: "/en/categories" },
  { label: "Vendors", href: "/en/vendors" },
  { label: "Blog", href: "/en/blog" },
  { label: "Contact", href: "/en/contact" },
];

const backUrl = "/en/vendors";

// Helper function to format array or string values
function formatValue(value: string | string[] | null | undefined): string {
  if (!value) return '';
  if (Array.isArray(value)) {
    return value.join(', ');
  }
  return String(value);
}
---

<BaseLayout 
  title={`${vendor.name} - Vendor Details - Automation List`}
  description={vendor.description || `Learn more about ${vendor.name}, a leading vendor in industrial automation.`}
  lang="en"
  navItems={engNavItems}
>
  <div class="container-px mx-auto max-w-4xl px-4 py-10">
    <a href={backUrl} class="text-sm text-brand-700 hover:text-brand-800 mb-6 inline-block">
      ‚Üê Back
    </a>

    <h1 class="text-3xl font-bold text-gray-900 mb-4">{vendor.name}</h1>

    {vendor.region && vendor.country && (
      <p class="text-gray-600 text-sm mb-2">{vendor.region}, {vendor.country}</p>
    )}
    {vendor.region && !vendor.country && (
      <p class="text-gray-600 text-sm mb-2">{vendor.region}</p>
    )}
    {!vendor.region && vendor.country && (
      <p class="text-gray-600 text-sm mb-2">{vendor.country}</p>
    )}

    {vendor.category && (
      <span class="inline-block px-2 py-1 text-xs font-medium bg-brand-50 text-brand-700 rounded mb-6">
        {vendor.category}
      </span>
    )}

    {vendor.description && (
      <p class="text-gray-700 text-sm leading-relaxed mb-4">{vendor.description}</p>
    )}

    {vendor.technologies && (
      <>
        <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-2">Technologies</h2>
        <p class="text-gray-700 text-sm leading-relaxed mb-4">{formatValue(vendor.technologies)}</p>
      </>
    )}

    {vendor.languages && (
      <>
        <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-2">Languages</h2>
        <p class="text-gray-700 text-sm leading-relaxed mb-4">{formatValue(vendor.languages)}</p>
      </>
    )}

    {vendor.certifications && (
      <>
        <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-2">Certifications</h2>
        <p class="text-gray-700 text-sm leading-relaxed mb-4">{formatValue(vendor.certifications)}</p>
      </>
    )}

    {vendor.tags && (
      <>
        <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-2">Tags</h2>
        <p class="text-gray-700 text-sm leading-relaxed mb-4">{formatValue(vendor.tags)}</p>
      </>
    )}

    {vendor.website && (
      <>
        <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-2">Website</h2>
        <p class="text-gray-700 text-sm leading-relaxed mb-4">
          <a href={vendor.website} target="_blank" rel="noopener noreferrer" class="text-brand-700 hover:text-brand-800">
            {vendor.website}
          </a>
        </p>
      </>
    )}

    {vendor.email && (
      <>
        <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-2">Email</h2>
        <p class="text-gray-700 text-sm leading-relaxed mb-4">
          <a href={`mailto:${vendor.email}`} class="text-brand-700 hover:text-brand-800">
            {vendor.email}
          </a>
        </p>
      </>
    )}

    {vendor.phone && (
      <>
        <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-2">Phone</h2>
        <p class="text-gray-700 text-sm leading-relaxed mb-4">
          <a href={`tel:${vendor.phone}`} class="text-brand-700 hover:text-brand-800">
            {vendor.phone}
          </a>
        </p>
      </>
    )}
  </div>
</BaseLayout>

